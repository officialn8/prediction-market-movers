-- Migration: Cleanup simulated data
-- Description: Removes all data generated by the simulator to prepare for live production use.

-- 1. Delete snapshots associated with simulated markets
DELETE FROM snapshots 
WHERE token_id IN (
    SELECT token_id 
    FROM market_tokens 
    JOIN markets ON market_tokens.market_id = markets.market_id 
    WHERE markets.source = 'simulated'
);

-- 2. Delete tokens associated with simulated markets
DELETE FROM market_tokens 
WHERE market_id IN (
    SELECT market_id 
    FROM markets 
    WHERE source = 'simulated'
);

-- 3. Delete the simulated markets themselves
DELETE FROM markets 
WHERE source = 'simulated';

-- 4. Clean up movers cache for simulated tokens (if any)
DELETE FROM movers_cache
WHERE token_id IN (
    SELECT token_id
    FROM market_tokens
    WHERE market_id IN (
        SELECT market_id 
        FROM markets 
        WHERE source = 'simulated'
    )
);
