# Prediction Market Movers - Environment Configuration
# Copy to .env and fill in values

# =============================================================================
# DATABASE
# =============================================================================
DATABASE_URL=postgresql://user:password@localhost:5432/prediction_movers

# Connection pool settings (adjust based on your Postgres limits)
DB_POOL_MIN_SIZE=2
DB_POOL_MAX_SIZE=10
DB_CONNECTION_TIMEOUT=30.0

# =============================================================================
# COLLECTOR
# =============================================================================
# Mode: "simulated" | "polymarket" | "live" (polymarket + kalshi)
COLLECTOR_MODE=polymarket

# Sync interval in seconds (for REST fallback)
COLLECTOR_INTERVAL_SECONDS=30

# Retention loop cadence (seconds)
RETENTION_RUN_INTERVAL_SECONDS=3600

# =============================================================================
# WEBSOCKET (Real-time)
# =============================================================================
# Use WebSocket for real-time Polymarket data (recommended)
POLYMARKET_USE_WSS=true

# Watchdog timeout - restart WSS if no messages for this many seconds
WSS_WATCHDOG_TIMEOUT=120

# Delay before reconnecting after WSS disconnect
WSS_RECONNECT_DELAY=5

# Refresh active Polymarket subscription universe periodically
POLYMARKET_SUBSCRIPTION_REFRESH_SECONDS=300

# Low-frequency full metadata refresh (URL/category/status correction)
POLYMARKET_FULL_METADATA_SYNC_ENABLED=true
POLYMARKET_FULL_METADATA_SYNC_INTERVAL_SECONDS=86400
POLYMARKET_FULL_METADATA_MAX_MARKETS=20000

# Snapshot write-gate controls (reduce write amplification)
SNAPSHOT_MIN_WRITE_INTERVAL_SECONDS=5
SNAPSHOT_FORCE_WRITE_DELTA_PP=0.5

# =============================================================================
# DATA RETENTION
# =============================================================================
# Days to keep raw snapshots
SNAPSHOT_RETENTION_DAYS=3

# Days to keep rollups and derived/event data
OHLC_1M_RETENTION_DAYS=14
OHLC_1H_RETENTION_DAYS=120
MOVERS_CACHE_RETENTION_DAYS=14
ALERTS_RETENTION_DAYS=30
VOLUME_SPIKES_RETENTION_DAYS=30
ARBITRAGE_RETENTION_DAYS=14
VOLUME_HOURLY_RETENTION_DAYS=120

# Emit table-size telemetry this often (seconds)
STORAGE_METRICS_INTERVAL_SECONDS=300

# Volume freshness TTLs used for scoring and alerts
VOLUME_WSS_STALE_AFTER_SECONDS=600
VOLUME_PROVIDER_STALE_AFTER_SECONDS=7200

# Hold zone: suppress borderline mover/alert triggers near thresholds
SIGNAL_HOLD_ZONE_ENABLED=true
SIGNAL_HOLD_ZONE_MOVE_PP=0.5
SIGNAL_HOLD_ZONE_QUALITY_SCORE=0.5
SIGNAL_HOLD_ZONE_SPIKE_RATIO=0.25

# Strict train-vs-live feature manifest validation for scorer inference
MODEL_FEATURE_MANIFEST_PATH=packages/core/analytics/mover_feature_manifest.json
MODEL_FEATURE_MANIFEST_STRICT=true

# Daily resolved-market scoring diagnostics (Brier/log-loss/calibration)
MODEL_SCORING_INTERVAL_SECONDS=86400
MODEL_SCORING_INITIAL_DELAY_SECONDS=900
MODEL_SCORING_CALIBRATION_BINS=10

# =============================================================================
# LOGGING
# =============================================================================
LOG_LEVEL=INFO

# =============================================================================
# BETTER AUTH (Authentication)
# =============================================================================
# Secret for session encryption (generate with: openssl rand -base64 32)
BETTER_AUTH_SECRET=change-me-in-production

# Base URL of your app (used for OAuth callbacks)
BETTER_AUTH_URL=http://localhost:3000

# Also set this for Next.js client
NEXT_PUBLIC_APP_URL=http://localhost:3000

# =============================================================================
# SOCIAL LOGIN (Optional)
# =============================================================================
# GitHub OAuth (https://github.com/settings/developers)
GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=

# Google OAuth (https://console.cloud.google.com/apis/credentials)
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=

# =============================================================================
# LEGACY API AUTH (Can be removed once BetterAuth is live)
# =============================================================================
# JWT secret for auth tokens (generate with: openssl rand -hex 32)
JWT_SECRET=change-me-in-production

# Frontend URL for redirects
FRONTEND_URL=http://localhost:3000

# =============================================================================
# KALSHI (WebSocket - Real-time)
# =============================================================================
# Enable Kalshi WebSocket for sub-millisecond data (requires API key)
# This is the BIGGEST accuracy improvement vs REST polling!
# Get API keys at: https://kalshi.com/account/api-keys
KALSHI_USE_WSS=false

# API key ID from Kalshi
KALSHI_API_KEY=

# Path to RSA private key file (downloaded from Kalshi)
# OR set KALSHI_PRIVATE_KEY with the PEM content directly
KALSHI_PRIVATE_KEY_PATH=./kalshi_private.pem
# KALSHI_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----"

# =============================================================================
# POLAR (Billing - Merchant of Record)
# =============================================================================
# Get from: https://polar.sh/settings → Organization Access Tokens
POLAR_ACCESS_TOKEN=polar_oat_...

# Get from: https://polar.sh/settings → Webhooks → Your endpoint → Secret
POLAR_WEBHOOK_SECRET=whsec_...

# Product IDs from your Polar dashboard (Products → Copy ID)
POLAR_PRO_PRODUCT_ID=prod_...
POLAR_ENTERPRISE_PRODUCT_ID=prod_...
